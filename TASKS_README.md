# Tasks Directory

## Overview

The `tasks/` directory is created automatically at runtime to store validation flags and other task-related state files. This directory is ignored by git (see `.gitignore`).

## Contents

### `.prerequisites_validated`

This file is created by `validate-prerequisites.sh` when all prerequisite checks pass.

**Sample contents:**
```bash
# Prerequisites Validation Success
# This file is automatically generated by validate-prerequisites.sh
# Last validated: 2025-10-13 09:45:23 UTC

VALIDATION_STATUS=passed
VALIDATION_TIMESTAMP=2025-10-13 09:45:23 UTC
AWS_CLI=installed
AWS_CREDENTIALS=configured
TASK_CLI=installed
SNOWFLAKE_CLI=installed
```

## Usage

### Automatic Creation

The `tasks/` directory and validation flag are automatically created when you run:

```bash
./validate-prerequisites.sh
```

### Checking Validation Status

Use the helper script:

```bash
./check-validation.sh
```

Or check manually:

```bash
if [ -f "tasks/.prerequisites_validated" ]; then
    echo "Prerequisites validated"
else
    echo "Prerequisites not validated"
fi
```

### Reading Validation Data

Source the file to access variables:

```bash
if [ -f "tasks/.prerequisites_validated" ]; then
    source tasks/.prerequisites_validated
    echo "Status: $VALIDATION_STATUS"
    echo "Timestamp: $VALIDATION_TIMESTAMP"
    echo "AWS CLI: $AWS_CLI"
fi
```

## File Lifecycle

### Creation
- Created by `validate-prerequisites.sh` when all checks pass
- Contains validation status and timestamp
- Lists status of each checked component

### Removal
- Automatically removed if validation fails on subsequent runs
- Can be manually deleted to force re-validation
- Ignored by git (not committed to repository)

### Regeneration
- Re-created each time validation passes
- Always contains fresh timestamp
- Updates component status

## Integration Examples

### In Bash Scripts

```bash
#!/bin/bash

# Check prerequisites before running
if [ ! -f "tasks/.prerequisites_validated" ]; then
    echo "Prerequisites not validated. Running validation..."
    ./validate-prerequisites.sh || exit 1
fi

# Source validation data
source tasks/.prerequisites_validated
echo "Running with validation from: $VALIDATION_TIMESTAMP"

# Your script logic here
```

### In Taskfile (task CLI)

```yaml
version: '3'

tasks:
  validate:
    desc: Validate prerequisites
    cmds:
      - ./validate-prerequisites.sh

  check:
    desc: Check if prerequisites are validated
    cmds:
      - ./check-validation.sh

  deploy:
    desc: Deploy (validates prerequisites first)
    deps:
      - validate
    cmds:
      - echo "Deploying..."
      - ./your-deployment-script.sh
```

### In CI/CD Pipeline

```yaml
# GitHub Actions example
steps:
  - name: Checkout code
    uses: actions/checkout@v2

  - name: Validate prerequisites
    run: ./validate-prerequisites.sh

  - name: Check validation
    run: ./check-validation.sh

  - name: Deploy
    run: ./deploy.sh
    if: success()
```

## Best Practices

1. **Don't commit tasks/ directory** - It's already in `.gitignore`
2. **Run validation before main operations** - Ensures environment is properly configured
3. **Check validation in CI/CD** - Catch missing tools early in pipeline
4. **Re-validate after updates** - After installing new tools or changing config
5. **Use check-validation.sh** - Quick status check without re-running validation

## Troubleshooting

### tasks/ directory not created

Run the validation script:
```bash
./validate-prerequisites.sh
```

### Validation flag missing

The flag is removed if validation fails. Check the validation output:
```bash
./validate-prerequisites.sh
```

### Old validation data

Delete and re-run validation:
```bash
rm -f tasks/.prerequisites_validated
./validate-prerequisites.sh
```

### Permission errors

Ensure scripts are executable:
```bash
chmod +x validate-prerequisites.sh check-validation.sh
```

## See Also

- [VALIDATION_GUIDE.md](VALIDATION_GUIDE.md) - Comprehensive validation documentation
- [README.md](README.md) - Main project documentation
- `.gitignore` - Git ignore configuration

